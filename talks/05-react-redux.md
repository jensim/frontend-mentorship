title: "react-redux"

--

<center>
  <h1>react-redux</h1>
  <br />
  <small>
    <i>In react we trust</i>
  </small>
  <br />
  <br />
  <small>
    by [Vladimir Starkov](https://iamstarkov.com)
    <br>
    frontend engineer at [Nordnet Bank AB](https://www.nordnet.se/)
  </small>
</center>

---

### redux

Redux is a predictable state container for JavaScript apps

also is a framework agnostic.

*TLDR: Change emitter holding a value*

---

### redux recap

* store **holds and guards** the state
* store offers ways to **access, update and subscribe** to the state
* actions are **update descriptions**
* reducers **apply updates**
* **state is just an object**
* next state is derived by applying reducer to an action

---

### react-redux

* `Provider` makes store available to the App through react's context
* `connect` connects component to the state allowing to select data from state and to dispatch actions.

reducers are needed only for creating the store.

---

### workflow

* design state's shape
* write actions and reducers
* create store with combined reducers
* `Provide` store to the App
* `connect` components to select relevant data and dispatch actions

---

### hey, what's the…

* action?
* action creator?
* reducer?
* `combineReducers`?

how do you make reducer react on actions?

<iframe src="https://www.random.org/widgets/integers/iframe.php?title=True+Random+Number+Generator&amp;buttontxt=Generate&amp;width=160&amp;height=200&amp;border=off&amp;bgcolor=%23FFFFFF&amp;txtcolor=%23777777&amp;altbgcolor=%23CCCCFF&amp;alttxtcolor=%23000000&amp;defaultmin=&amp;defaultmax=&amp;fixed=off" frameborder="0" width="160" height="200" scrolling="no" longdesc="https://www.random.org/integers/">
The numbers generated by this widget come from RANDOM.ORG's true random number generator.
</iframe>


---

### [Provider](https://github.com/reduxjs/react-redux/blob/master/docs/api.md#provider-store)

Makes the Redux store available to the `connect()` calls in the component hierarchy below. Normally, you can’t use `connect()` without wrapping a parent or ancestor component in `<Provider>`.

---

### [Provider](https://github.com/reduxjs/react-redux/blob/master/docs/api.md#provider-store)

```js
ReactDOM.render(
  <App />,
  document.getElementById('root')
);
```

with react-redux:

```js
const store = createStore(rootReducer);

ReactDOM.render(
  <Provider store={store}>
    <App />
  </Provider>,
  document.getElementById('root')
)
```

---

### [connect()](https://github.com/reduxjs/react-redux/blob/master/docs/api.md#connectmapstatetoprops-mapdispatchtoprops-mergeprops-options)

* Connects a React component to a Redux store.
* It does not modify the component passed to it; instead, it returns a new, connected component for you to use.
* `mapStateToProps` allows you to select data from state and pass it to component
* `mapDispatchToProps` allows you to dispatch actions to update state.
* updates or re-renders whenever state is updated

---

### [connect()](https://github.com/reduxjs/react-redux/blob/master/docs/api.md#connectmapstatetoprops-mapdispatchtoprops-mergeprops-options)

```js
// State: { clicked: Number }
const mapStateToProps = state => {
  return { clicked: state.clicked }
};
const mapDispatchToProps = dispatch => {
  return { dispatch: dispatch }
};

const Counter = props => {
  const { clicked, dispatch } = props;
  return (
    <div>
      { clicked }
      <button onClick={e => dispatch({ type: 'DEC' })}>-</button>
      <button onClick={e => dispatch({ type: 'INC' })}>+</button>
    </div>
  )
}

export default connect(mapStateToProps, mapDispatchToProps)(Counter);
```

---

### [connect()](https://github.com/reduxjs/react-redux/blob/master/docs/api.md#connectmapstatetoprops-mapdispatchtoprops-mergeprops-options)

`mapStateToProps` pulls data from state / `store.getState()`

`mapDispatchToProps`&nbsp;updates¹&nbsp;the&nbsp;state&nbsp;/&nbsp;`store.dispatch()`

<small>[1]: through dispatch and reducers</small>

---

### mapStateToProps

_input:_ the whole `state` and `ownProps` passed to component  
_output:_ `stateProps`—additional props passed to component on top of its `ownProps`

just state (80%):
```js
const mapStateToProps = state => {
  return {
    showDetailedGraph: state.ui.showDetailedGraph
  }
};
```

state and props (20%):
```js
const mapStateToProps = (state, ownProps) => {
  const allItems = state.data;
  const id = ownProps.id;
  const item = allItems[id];
  return {
    item: item
  }
};
```

---

### mapDispatchToProps as a naïve function (0%)

_input:_ `store.dispatch`, `ownProps` passed to component  
_output:_ `dispatchProps`—additional props passed to component on top of its `ownProps`

```js
const mapDispatchToProps = dispatch => {
  return {
    dispatch: dispatch,
  }
};
```

_pros:_ simple, powerful  
_cons:_ component needs to know impl details of actions, TIL: [The Law of Leaky Abstractions](https://www.joelonsoftware.com/2002/11/11/the-law-of-leaky-abstractions/)

---

### mapDispatchToProps as a better function (20%)

_input:_ `store.dispatch`, `ownProps` passed to component  
_output:_ `dispatchProps`—additional props passed to component on top of its `ownProps`

```js
const addTodo = text => ({ type: 'ADD_TODO', payload: text });
const toggleTodo = id => ({ type: 'TOGGLE_TODO', payload: id });

const mapDispatchToProps = dispatch => {
  return {
    addTodo: text => dispatch(addTodo(text)),
    toggleTodo: text => dispatch(toggleTodo(text)),
  }
};
```

_pros:_ powerful, doesnt leak  
_cons:_ complex and cumbersome

---

### mapDispatchToProps as an object (80%)

_~~input, output:~~_ its not a function, just a plain js object

```js
const addTodo = text => ({ type: 'ADD_TODO', payload: text });
const toggleTodo = id => ({ type: 'TOGGLE_TODO', payload: id });

const mapDispatchToProps = {
    addTodo,
    toggleTodo,
}
```

_pros:_ powerful, simple, doesnt leak  
_cons:_ doesnt have access to `ownProps`

---

### react-redux recap

* you still write actions, reducers and `createStore` outside of the app.
* you make `store` accessible for the whole App with `Provider`
* you `connect` to store and
  * `mapStateToProps` to access data from the state
  * `mapDispatchToProps` to update<sup>＊</sup> state

---

### further reading

* [API docs](https://github.com/reduxjs/react-redux/blob/master/docs/api.md#api)
* ["awesome-redux" list](https://github.com/xgrommx/awesome-redux)

---

<center>
  <h1>react-redux</h1>
  <br />
  <small>
    <i>In react we trust</i>
  </small>
  <br />
  <br />
  <small>
    by [Vladimir Starkov](https://iamstarkov.com)
    <br>
    frontend engineer at [Nordnet Bank AB](https://www.nordnet.se/)
  </small>
</center>
